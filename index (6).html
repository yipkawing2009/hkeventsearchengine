<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HK æ´»å‹•é€š Â· HK Events</title>
  <meta name="description" content="é¦™æ¸¯æ´»å‹•è³‡è¨Šï½œå¸‚é›†ï½œå±•è¦½ï½œéŸ³æ¨‚æœƒï½œè¦ªå­ï½œé‹å‹•">
  <style>
    :root {
      --radius: 14px;
      --gap: 12px;
      --shadow: 0 6px 24px rgba(0,0,0,.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang HK", "PingFang SC", "Noto Sans CJK HK", "Microsoft JhengHei", "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      background: #f7f7fb;
      color: #171717;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: #ffffffcc; backdrop-filter: saturate(180%) blur(12px);
      border-bottom: 1px solid #eee;
    }
    .container { max-width: 980px; margin: 0 auto; padding: 16px; }
    .brand {
      display: flex; align-items: center; gap: 12px; padding: 6px 0;
    }
    .brand h1 { margin: 0; font-size: 20px; }
    .brand small { color: #666; }
    .filters {
      display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: var(--gap);
      margin-top: 12px;
    }
    .filters input, .filters select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd; border-radius: 10px; background: #fff;
    }
    .chipbar { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
    .chip {
      padding: 6px 10px; background: #fff; border: 1px solid #eee; border-radius: 20px; cursor: pointer;
    }
    .chip.active { background: #111; color: #fff; }
    .grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;
    }
    @media (max-width: 720px) { .grid { grid-template-columns: 1fr; } .filters{ grid-template-columns: 1fr 1fr; } }
    .card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden; display: flex; flex-direction: column;
    }
    .badge { display:inline-block; font-size:12px; background:#111; color:#fff; padding:4px 8px; border-radius:12px; }
    .thumb { width:100%; height: 160px; background: linear-gradient(120deg,#fafafa,#f0f0f0); display:flex; align-items:center; justify-content:center; color:#777; font-size:14px; }
    .content { padding: 14px; display:flex; flex-direction:column; gap:8px; }
    .title { margin:0; font-size: 18px; }
    .meta { color:#555; font-size: 14px; }
    .tags { display:flex; gap:6px; flex-wrap: wrap; }
    .tag { font-size:12px; background:#f1f1f1; padding:2px 8px; border-radius: 10px; }
    .actions { margin-top: 8px; display:flex; gap: 8px; }
    .btn {
      padding: 10px 14px; border-radius: 10px; border:1px solid #ddd; background:#fff; cursor:pointer;
    }
    .btn.primary { background:#111; color:#fff; border-color:#111; }
    .footer { color:#666; text-align:center; padding: 32px 12px; }
    .empty { text-align:center; color:#666; padding: 24px; }
    .toolbar { display:flex; align-items:center; gap:8px; justify-content:space-between; margin-top: 8px; }
    .toolbar .right { display:flex; gap:8px; }
    .pill { border:1px solid #ddd; padding:8px 12px; border-radius:999px; background:#fff; }
    a { color:inherit; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="brand">
        <h1>HK æ´»å‹•é€š</h1>
        <small>å¸‚é›† Â· å±•è¦½ Â· éŸ³æ¨‚ Â· è¦ªå­ Â· é‹å‹•</small>
      </div>
      <div class="toolbar">
        <input id="q" class="pill" placeholder="æœå°‹æ´»å‹•åç¨±ã€åœ°é»ã€æ¨™ç±¤â€¦" />
        <div class="right">
          <select id="sort" class="pill">
            <option value="soonest">æŒ‰æ—¥æœŸï¼ˆæœ€è¿‘ï¼‰</option>
            <option value="popular">æŒ‰äººæ°£</option>
            <option value="newest">æŒ‰æ–°å¢</option>
          </select>
          <a id="submitLink" class="pill" href="https://forms.gle/submit-your-event" target="_blank" rel="noopener">æäº¤æ´»å‹•</a>
        </div>
      </div>
      <div class="filters">
        <select id="district">
          <option value="">å…¨éƒ¨åœ°å€</option>
          <option>Hong Kong Island</option>
          <option>Kowloon</option>
          <option>New Territories</option>
        </select>
        <select id="category">
          <option value="">å…¨éƒ¨é¡åˆ¥</option>
          <option>Market</option>
          <option>Music</option>
          <option>Expo</option>
          <option>Sports</option>
          <option>Family</option>
          <option>Art</option>
        </select>
        <input id="from" type="date" />
        <input id="to" type="date" />
      </div>
      <div class="chipbar" id="quickChips">
      </div>
    </div>
  </header>

  <main class="container">
    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ´»å‹•ã€‚</div>
    <div class="footer">
      <div>Â© 2025 HK æ´»å‹•é€š Â· <a href="#" onclick="exportCSV();return false;">åŒ¯å‡º CSV</a></div>
      <div style="margin-top:6px; font-size: 13px;">å¦‚ä½•è³ºéŒ¢ï¼šæ´»å‹•ç½®é ‚ï¼ˆFeaturedï¼‰ã€å•†æˆ¶æ¨å»£ã€App å…§å»£å‘Šã€å”®ç¥¨åˆ†æˆã€‚</div>
    </div>
  </main>

  <script>
  // --- Sample data (å¯æ”¹ç‚º fetch å¤–éƒ¨ JSON) ---
  const EVENTS = [{"id": "evt001", "title": "ä¸­ç’°æµ·æ¿±è–èª•å¸‚é›†", "category": "Market", "district": "Hong Kong Island", "venue": "ä¸­ç’°æµ·æ¿±æ´»å‹•ç©ºé–“", "start_date": "2025-12-05", "end_date": "2025-12-26", "start_time": "12:00", "end_time": "22:00", "price": "å…è²»å…¥å ´", "tags": ["å¸‚é›†", "è–èª•", "è¦ªå­"], "url": "https://example.com/event/christmas-market", "image": "", "featured": true, "popularity": 80, "desc": "è¶…é 100 å€‹æ”¤ä½ã€éŸ³æ¨‚è¡¨æ¼”ã€è–èª•ç‡ˆé£¾æ‰“å¡ä½ã€‚"}, {"id": "evt002", "title": "å°–æ²™å’€è·¨å¹´å€’æ•¸éŸ³æ¨‚æœƒ", "category": "Music", "district": "Kowloon", "venue": "å°–æ²™å’€æµ·æ¿±é•·å»Š", "start_date": "2025-12-31", "end_date": "2025-12-31", "start_time": "20:00", "end_time": "00:30", "price": "å…è²»", "tags": ["è·¨å¹´", "éŸ³æ¨‚æœƒ", "éœ²å¤©"], "url": "https://example.com/event/countdown", "image": "", "featured": true, "popularity": 95, "desc": "ç¾å ´æ¨‚éšŠè¡¨æ¼”ã€ç…™èŠ±å€’æ•¸ï¼Œä¸€é½Šè¿æ¥ 2026ï¼"}, {"id": "evt003", "title": "èƒç£æœ¬åœ°æ‰‹ä½œå¸‚é›†", "category": "Market", "district": "New Territories", "venue": "èƒæ–°å¤©åœ°å»£å ´", "start_date": "2025-11-22", "end_date": "2025-11-23", "start_time": "11:00", "end_time": "20:00", "price": "å…è²»", "tags": ["æ‰‹ä½œ", "æœ¬åœ°å“ç‰Œ"], "url": "https://example.com/event/tsuenwan-handmade", "image": "", "featured": false, "popularity": 60, "desc": "é›†åˆæœ¬åœ°æ‰‹ä½œäººã€å·¥ä½œåŠåŠå°å‹éŸ³æ¨‚æ¼”å‡ºã€‚"}, {"id": "evt004", "title": "ç£ä»”è¨­è¨ˆå±•", "category": "Expo", "district": "Hong Kong Island", "venue": "ç£ä»”æœƒå±•", "start_date": "2025-11-28", "end_date": "2025-12-02", "start_time": "10:00", "end_time": "19:00", "price": "HKD 60", "tags": ["è¨­è¨ˆ", "å±•è¦½", "å‰µç§‘"], "url": "https://example.com/event/design-fair", "image": "", "featured": false, "popularity": 70, "desc": "å¹´åº¦è¨­è¨ˆç››äº‹ï¼Œé›†åˆäºæ´²å€å“ç‰ŒåŠæ–°éŠ³è¨­è¨ˆå¸«ã€‚"}, {"id": "evt005", "title": "æ¸¯å³¶10K è·¯è·‘è³½", "category": "Sports", "district": "Hong Kong Island", "venue": "ç¶­å¤šåˆ©äºå…¬åœ’èµ·æ­¥", "start_date": "2026-01-12", "end_date": "2026-01-12", "start_time": "07:30", "end_time": "10:30", "price": "HKD 180", "tags": ["è·‘æ­¥", "é‹å‹•"], "url": "https://example.com/event/hk10k", "image": "", "featured": false, "popularity": 50, "desc": "åŸå¸‚è·‘è³½ï¼Œè¨­ 5K / 10K çµ„åˆ¥ã€‚"}, {"id": "evt006", "title": "è¦ªå­ç§‘å­¸ç©æ¨‚æ—¥", "category": "Family", "district": "Kowloon", "venue": "ä¹é¾ç£å±•è²¿ä¸­å¿ƒ", "start_date": "2025-12-14", "end_date": "2025-12-14", "start_time": "10:00", "end_time": "18:00", "price": "HKD 50ï¼ˆæˆäººï¼‰/ å…’ç«¥å…è²»", "tags": ["è¦ªå­", "ç§‘å­¸", "æ•™è‚²"], "url": "https://example.com/event/family-science", "image": "", "featured": false, "popularity": 65, "desc": "äº’å‹•ç§‘å­¸æ”¤ä½ã€STEM é«”é©—ã€å…’ç«¥èˆå°ç¯€ç›®ã€‚"}, {"id": "evt007", "title": "å±¯é–€äºŒæ‰‹å¯¶è—è·³èš¤å¸‚å ´", "category": "Market", "district": "New Territories", "venue": "å±¯é–€å¸‚å»£å ´", "start_date": "2025-12-07", "end_date": "2025-12-07", "start_time": "12:00", "end_time": "19:00", "price": "å…è²»", "tags": ["äºŒæ‰‹", "ç’°ä¿"], "url": "https://example.com/event/flea-market", "image": "", "featured": false, "popularity": 55, "desc": "ä»¥ç‰©æ˜“ç‰©ã€ç’°ä¿å†ç”¨ï¼Œå°‹å¯¶æ¨‚è¶£ç„¡çª®ã€‚"}, {"id": "evt008", "title": "æœ¬åœ°ç¨ç«‹é›»å½±æ”¾æ˜ é€±", "category": "Art", "district": "Kowloon", "venue": "æ²¹éº»åœ°æˆ²é™¢", "start_date": "2025-11-27", "end_date": "2025-12-03", "start_time": "18:30", "end_time": "22:30", "price": "HKD 80", "tags": ["é›»å½±", "è—è¡“"], "url": "https://example.com/event/indie-film", "image": "", "featured": false, "popularity": 45, "desc": "å¤šå ´æœ¬åœ°çŸ­ç‰‡åŠé•·ç‰‡å±•æ˜ ï¼Œæ˜ å¾Œè«‡åˆ†äº«ã€‚"}];

  const S = {
    q: document.getElementById('q'),
    district: document.getElementById('district'),
    category: document.getElementById('category'),
    from: document.getElementById('from'),
    to: document.getElementById('to'),
    sort: document.getElementById('sort'),
    list: document.getElementById('list'),
    empty: document.getElementById('empty'),
    chips: document.getElementById('quickChips')
  };

  const QUICK = [
    { label: "æœ¬é€±æœ«", type: "range", value: "weekend" },
    { label: "å…è²»", type: "tag", value: "å…è²»" },
    { label: "å¸‚é›†", type: "category", value: "Market" },
    { label: "è¦ªå­", type: "category", value: "Family" },
    { label: "éŸ³æ¨‚", type: "category", value: "Music" },
  ];

  let state = {
    q: "", district: "", category: "", from: "", to: "", sort: "soonest",
    activeChip: null
  };

  function init() {
    const today = new Date().toISOString().slice(0,10);
    S.from.value = today;

    QUICK.forEach((c, i) => {
      const el = document.createElement('button');
      el.className = 'chip';
      el.textContent = c.label;
      el.onclick = () => toggleChip(i);
      S.chips.appendChild(el);
    });

    bind();
    render();
  }

  function toggleChip(i) {
    state.activeChip = state.activeChip === i ? null : i;
    state.category = ""; S.category.value = "";
    S.q.value = ""; state.q = "";
    const c = QUICK[i];
    if (state.activeChip !== null) {
      if (c.type === "category") { state.category = c.value; S.category.value = c.value; }
      if (c.type === "tag") { state.q = c.value; S.q.value = c.value; }
      if (c.type === "range" && c.value === "weekend") {
        const now = new Date();
        const day = now.getDay();
        const diffToSat = (6 - day + 7) % 7;
        const sat = new Date(now.getFullYear(), now.getMonth(), now.getDate() + diffToSat);
        const sun = new Date(now.getFullYear(), now.getMonth(), now.getDate() + diffToSat + 1);
        S.from.value = sat.toISOString().slice(0,10);
        S.to.value = sun.toISOString().slice(0,10);
      }
    } else {
      S.to.value = "";
    }
    highlightChips();
    render();
  }

  function highlightChips() {
    [...S.chips.children].forEach((el, idx) => {
      el.classList.toggle('active', idx === state.activeChip);
    });
  }

  function bind() {
    S.q.oninput = () => { state.q = S.q.value.trim(); render(); };
    S.district.onchange = () => { state.district = S.district.value; render(); };
    S.category.onchange = () => { state.category = S.category.value; render(); };
    S.from.onchange = () => { state.from = S.from.value; render(); };
    S.to.onchange = () => { state.to = S.to.value; render(); };
    S.sort.onchange = () => { state.sort = S.sort.value; render(); };
  }

  function inRange(ev, from, to) {
    const s = new Date(ev.start_date);
    const e = new Date(ev.end_date || ev.start_date);
    const f = from ? new Date(from) : null;
    const t = to ? new Date(to) : null;
    if (f && e < f) return false;
    if (t && s > t) return false;
    return true;
  }

  function render() {
    const q = state.q.toLowerCase();
    let rows = [...EVENTS];

    rows = rows.filter(ev => inRange(ev, S.from.value, S.to.value));
    if (state.district) rows = rows.filter(ev => ev.district === state.district);
    if (state.category) rows = rows.filter(ev => ev.category === state.category);
    if (q) rows = rows.filter(ev =>
      (ev.title + " " + ev.venue + " " + ev.tags.join(" ") + " " + (ev.desc||"")).toLowerCase().includes(q)
    );

    if (state.sort === "soonest") rows.sort((a,b) => new Date(a.start_date) - new Date(b.start_date));
    if (state.sort === "popular") rows.sort((a,b) => (b.featured?1000:0)+b.popularity - ((a.featured?1000:0)+a.popularity));
    if (state.sort === "newest") rows.reverse();

    S.list.innerHTML = "";
    S.empty.style.display = rows.length ? "none" : "block";

    rows.forEach(ev => S.list.appendChild(card(ev)));
  }

  function fmtDate(ev) {
    if (ev.start_date === ev.end_date) return ev.start_date;
    return ev.start_date + " â€” " + ev.end_date;
  }

  function card(ev) {
    const el = document.createElement('article');
    el.className = "card";
    el.innerHTML = `
      <div class="thumb">{{thumb}}</div>
      <div class="content">
        <div>${ev.featured ? '<span class="badge">Featured</span>' : ''}</div>
        <h3 class="title">${ev.title}</h3>
        <div class="meta">ğŸ“ ${ev.venue} Â· ${ev.district}</div>
        <div class="meta">ğŸ—“ï¸ ${fmtDate(ev)} Â· â° ${ev.start_time}â€“${ev.end_time}</div>
        <div class="meta">ğŸ’µ ${ev.price}</div>
        <div class="tags">
          <span class="tag">${ev.category}</span>
          ${ev.tags.map(t => `<span class="tag">${t}</span>`).join('')}
        </div>
        <div class="actions">
          <a class="btn primary" href="${ev.url}" target="_blank" rel="noopener">æ´»å‹•é€£çµ</a>
          <button class="btn" onclick="copyShare('${ev.id}')">åˆ†äº«</button>
        </div>
      </div>
    `.replace("{{thumb}}", ev.image ? `<img alt="" src="${ev.image}" style="width:100%;height:100%;object-fit:cover"/>` : "æ´»å‹•æµ·å ±");
    return el;
  }

  function copyShare(id) {
    const url = new URL(window.location);
    url.searchParams.set("id", id);
    navigator.clipboard.writeText(url.toString());
    alert("å·²è¤‡è£½åˆ†äº«é€£çµ");
  }

  function exportCSV() {
    const cols = ["id","title","category","district","venue","start_date","end_date","start_time","end_time","price","tags","url","featured","popularity","desc"];
    const lines = [cols.join(",")];
    EVENTS.forEach(ev => {
      const row = cols.map(k => {
        let v = ev[k];
        if (Array.isArray(v)) v = v.join("|");
        if (typeof v === 'string' && (v.includes(',') || v.includes('\n'))) v = '"' + v.replaceAll('"','""') + '"';
        return v;
      });
      lines.push(row.join(","));
    });
    const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "hk_events.csv";
    a.click();
  }

  // Optional: fetch external JSON file (events.json) if exists
  fetch("events.json").then(r => r.ok ? r.json() : Promise.reject()).then(data => {
    if (Array.isArray(data) && data.length) {
      EVENTS.length = 0; data.forEach(x => EVENTS.push(x));
      render();
    }
  }).catch(() => { /* ignore */ });

  init();
  </script>
</body>
</html>
